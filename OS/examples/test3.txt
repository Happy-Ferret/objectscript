
[FILE] test3.os
[1] print 7 && 9

begin function
  begin locals, total 14
    6 Person
    7 p
    8 IvanPerson
    9 p
    10 vec3
    11 v1
    12 v2
    13 v3
  end locals
  begin call
    get env var print
    begin params 1
      begin logic &&
        push const number 7
        push const number 9
      end logic &&
    end params ret values 1
  end call ret values 0


[2] print 7 || 9

  begin call
    get env var print
    begin params 1
      begin logic ||
        push const number 7
        push const number 9
      end logic ||
    end params ret values 1
  end call ret values 0


[5] var i = 4

  begin scope
    begin locals 4
      0 i
      1 name
      2 count
      3 time
    end locals
    begin set local var
      push const number 4
    end set local var i (0 0 param)


[6] var name, count, time = "Smith", 3 + 2/i, 1.23

    begin set local var
      begin set local var
        begin set local var
          begin params 3
            push const string "Smith"
            ,
            begin operator +
              push const number 3
              begin operator /
                push const number 2
                get local var i (0 0 param)
              end operator /
            end operator +
            ,
            push const number 1.23
          end params ret values 3
        end set local var time (3 0 param)
      end set local var count (2 0 param)
    end set local var name (1 0 param)


[7] print concat("name: " name ", count: " count ", time: " time)

    begin call
      get env var print
      begin params 1
        begin call
          get env var concat
          begin params 6
            push const string "name: "
            ,
            get local var name (1 0 param)
            ,
            push const string ", count: "
            ,
            get local var count (2 0 param)
            ,
            push const string ", time: "
            ,
            get local var time (3 0 param)
          end params ret values 6
        end call ret values 1
      end params ret values 1
    end call ret values 0
  end scope ret values 0


[18] }(10)

  begin call

[12] function(a){

    begin function
      begin locals, total 3
        0 a (param)
        1 c
      end locals

[13] var c = a * 2;

      begin set local var
        begin operator *
          get local var a (0 0)
          push const number 2
        end operator *
      end set local var c (1 0 param)


[15] var c = a - 1

      begin scope
        begin locals 1
          2 c
        end locals
        begin set local var
          begin operator -
            get local var a (0 0)
            push const number 1
          end operator -
        end set local var c (2 0 param)


[16] print debuglocals

        begin call
          get env var print
          begin params 1
            begin debug locals
              begin object 9
                begin set by name
                  get local var Person (6 1 param)
                end set by name: [Person]
                ,
                begin set by name
                  get local var IvanPerson (8 1 param)
                end set by name: [IvanPerson]
                ,
                begin set by name
                  get local var p (9 1 param)
                end set by name: [p]
                ,
                begin set by name
                  get local var vec3 (10 1 param)
                end set by name: [vec3]
                ,
                begin set by name
                  get local var v1 (11 1 param)
                end set by name: [v1]
                ,
                begin set by name
                  get local var v2 (12 1 param)
                end set by name: [v2]
                ,
                begin set by name
                  get local var v3 (13 1 param)
                end set by name: [v3]
                ,
                begin set by name
                  get local var a (0 0)
                end set by name: [a]
                ,
                begin set by name
                  get local var c (2 0 param)
                end set by name: [c]
              end object
            end debug locals
          end params ret values 1
        end call ret values 0
      end scope ret values 0
    end function

[18] }(10)

    begin params 1
      push const number 10
    end params ret values 1
  end call ret values 0


[23] var v1 = {x=1 y=2}

  begin scope
    begin locals 2
      4 v1
      5 a
    end locals
    begin set local var
      begin object 2
        begin set by name
          push const number 1
        end set by name: [x]
        ,
        begin set by name
          push const number 2
        end set by name: [y]
      end object
    end set local var v1 (4 0 param)


[24] var a = {[v1]="vv1" v2="vv2"}

    begin set local var
      begin object 2
        begin set by exp
          get local var v1 (4 0 param)
          push const string "vv1"
        end set by exp
        ,
        begin set by name
          push const string "vv2"
        end set by name: [v2]
      end object
    end set local var a (5 0 param)


[25] print( a[v1] a.v2 )

    begin call
      get env var print
      begin params 2
        begin get property
          get local var a (5 0 param)
          get local var v1 (4 0 param)
        end get property ret values 1
        ,
        begin get property
          get local var a (5 0 param)
          push const string "v2"
        end get property ret values 1
      end params ret values 2
    end call ret values 0
  end scope ret values 0


[29] var Person = {

  begin set local var
    begin object 3

[30] __construct: function(firstname, lastname){

      begin set by name
        begin function
          begin locals, total 2
            0 firstname (param)
            1 lastname (param)
          end locals

[31] this.firstname = firstname

          begin set property
            get local var firstname (0 0)
            push this
            push const string "firstname"
          end set property ret values 0


[32] this.lastname = lastname

          begin set property
            get local var lastname (1 0)
            push this
            push const string "lastname"
          end set property ret values 0
        end function
      end set by name: [__construct]
      ,

[34] walk = function(){

      begin set by name
        begin function

[35] print this.fullname .. " is walking!"

          begin call
            get env var print
            begin params 1
              begin operator ..
                begin get property
                  push this
                  push const string "fullname"
                end get property ret values 1
                push const string " is walking!"
              end operator ..
            end params ret values 1
          end call ret values 0
        end function
      end set by name: [walk]
      ,

[37] __get@fullname = function(){

      begin set by name
        begin function

[38] return this.firstname .. " " .. this.lastname

          begin return
            begin operator ..
              begin operator ..
                begin get property
                  push this
                  push const string "firstname"
                end get property ret values 1
                push const string " "
              end operator ..
              begin get property
                push this
                push const string "lastname"
              end get property ret values 1
            end operator ..
          end return values 1
        end function
      end set by name: [__get@fullname]
    end object
  end set local var Person (6 0 param)


[42] var p = Person("James", "Bond")

  begin set local var
    begin call
      get local var Person (6 0 param)
      begin params 2
        push const string "James"
        ,
        push const string "Bond"
      end params ret values 2
    end call ret values 1
  end set local var p (7 0 param)


[43] p.walk()

  begin call method
    get local var p (7 0 param)
    begin params 2
      push const string "walk"
      ,
      nop
    end params ret values 1
  end call method ret values 0


[44] print p

  begin call
    get env var print
    begin params 1
      get local var p (7 0 param)
    end params ret values 1
  end call ret values 0


[46] var IvanPerson = extends Person {

  begin set local var
    begin extends
      get local var Person (6 0 param)
      begin object 1

[47] __construct: function(){

        begin set by name
          begin function

[48] super.__construct.call(this, "Ivan", "Petrov")

            begin call method
              begin get property
                super
                push const string "__construct"
              end get property ret values 1
              begin params 4
                push const string "call"
                ,
                push this
                ,
                push const string "Ivan"
                ,
                push const string "Petrov"
              end params ret values 4
            end call method ret values 0
          end function
        end set by name: [__construct]
      end object
    end extends ret values 1
  end set local var IvanPerson (8 0 param)


[51] var p = IvanPerson()

  begin set local var
    begin call
      get local var IvanPerson (8 0 param)
      begin params 1
        nop
      end params ret values 0
    end call ret values 1
  end set local var p (9 0 param)


[52] p.walk()

  begin call method
    get local var p (9 0 param)
    begin params 2
      push const string "walk"
      ,
      nop
    end params ret values 1
  end call method ret values 0


[53] print p

  begin call
    get env var print
    begin params 1
      get local var p (9 0 param)
    end params ret values 1
  end call ret values 0


[57] var vec3 = {

  begin set local var
    begin object 3

[58] __construct = function(x, y, z){

      begin set by name
        begin function
          begin locals, total 3
            0 x (param)
            1 y (param)
            2 z (param)
          end locals

[59] this.x = x

          begin set property
            get local var x (0 0)
            push this
            push const string "x"
          end set property ret values 0


[60] this.y = y

          begin set property
            get local var y (1 0)
            push this
            push const string "y"
          end set property ret values 0


[61] this.z = z

          begin set property
            get local var z (2 0)
            push this
            push const string "z"
          end set property ret values 0
        end function
      end set by name: [__construct]
      ,

[63] __add = function(a, b){

      begin set by name
        begin function
          begin locals, total 2
            0 a (param)
            1 b (param)
          end locals

[64] return vec3(a.x + b.x, a.y + b.y, a.z + b.z)

          begin tail call
            get local var vec3 (10 1 param)
            begin params 3
              begin operator +
                begin get property
                  get local var a (0 0)
                  push const string "x"
                end get property ret values 1
                begin get property
                  get local var b (1 0)
                  push const string "x"
                end get property ret values 1
              end operator +
              ,
              begin operator +
                begin get property
                  get local var a (0 0)
                  push const string "y"
                end get property ret values 1
                begin get property
                  get local var b (1 0)
                  push const string "y"
                end get property ret values 1
              end operator +
              ,
              begin operator +
                begin get property
                  get local var a (0 0)
                  push const string "z"
                end get property ret values 1
                begin get property
                  get local var b (1 0)
                  push const string "z"
                end get property ret values 1
              end operator +
            end params ret values 3
          end tail call
        end function
      end set by name: [__add]
      ,

[66] __mul = function(a, b){

      begin set by name
        begin function
          begin locals, total 2
            0 a (param)
            1 b (param)
          end locals

[67] return vec3(a.x * b.x, a.y * b.y, a.z * b.z)

          begin tail call
            get local var vec3 (10 1 param)
            begin params 3
              begin operator *
                begin get property
                  get local var a (0 0)
                  push const string "x"
                end get property ret values 1
                begin get property
                  get local var b (1 0)
                  push const string "x"
                end get property ret values 1
              end operator *
              ,
              begin operator *
                begin get property
                  get local var a (0 0)
                  push const string "y"
                end get property ret values 1
                begin get property
                  get local var b (1 0)
                  push const string "y"
                end get property ret values 1
              end operator *
              ,
              begin operator *
                begin get property
                  get local var a (0 0)
                  push const string "z"
                end get property ret values 1
                begin get property
                  get local var b (1 0)
                  push const string "z"
                end get property ret values 1
              end operator *
            end params ret values 3
          end tail call
        end function
      end set by name: [__mul]
    end object
  end set local var vec3 (10 0 param)


[71] var v1 = vec3(10 20 30)

  begin set local var
    begin call
      get local var vec3 (10 0 param)
      begin params 3
        push const number 10
        ,
        push const number 20
        ,
        push const number 30
      end params ret values 3
    end call ret values 1
  end set local var v1 (11 0 param)


[72] var v2 = vec3(1 2 3)

  begin set local var
    begin call
      get local var vec3 (10 0 param)
      begin params 3
        push const number 1
        ,
        push const number 2
        ,
        push const number 3
      end params ret values 3
    end call ret values 1
  end set local var v2 (12 0 param)


[73] var v3 = v1 + v2 * v2

  begin set local var
    begin operator +
      get local var v1 (11 0 param)
      begin operator *
        get local var v2 (12 0 param)
        get local var v2 (12 0 param)
      end operator *
    end operator +
  end set local var v3 (13 0 param)


[74] print v3

  begin call
    get env var print
    begin params 1
      get local var v3 (13 0 param)
    end params ret values 1
  end call ret values 0
end function
